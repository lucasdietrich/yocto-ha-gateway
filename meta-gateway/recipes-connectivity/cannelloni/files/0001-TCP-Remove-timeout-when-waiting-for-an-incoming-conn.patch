From 231f018e48ceab05076709af1afe3f002bf6494f Mon Sep 17 00:00:00 2001
From: Lucas Dietrich <lucas.dietrich.git@proton.me>
Date: Fri, 15 Aug 2025 11:41:23 +0200
Subject: [PATCH] TCP: Remove timeout when waiting for an incoming connection

---
 tcp_server_thread.cpp | 7 ++-----
 tcpthread.cpp         | 2 +-
 2 files changed, 3 insertions(+), 6 deletions(-)

diff --git a/tcp_server_thread.cpp b/tcp_server_thread.cpp
index 9c27996..d8a650e 100644
--- a/tcp_server_thread.cpp
+++ b/tcp_server_thread.cpp
@@ -59,17 +59,14 @@ bool TCPServerThread::attempt_connect() {
   char connAddrStr[INET_ADDRSTRLEN];
   socklen_t connAddrLen = sizeof(connAddr);
   fd_set readfds;
-  struct timeval timeout;
 
   listen(m_serverSocket, 1);
   FD_ZERO(&readfds);
   FD_SET(m_serverSocket, &readfds);
 
   linfo << "Waiting for a client to connect." << std::endl;
-  /* Set Timeout to 1 second */
-  timeout.tv_sec = 1;
-  timeout.tv_usec = 0;
-  int ret = select(m_serverSocket+1, &readfds, NULL, NULL, &timeout);
+  /* Wait forever for a connection */
+  int ret = select(m_serverSocket+1, &readfds, NULL, NULL, NULL);
   if (ret < 0) {
     lerror << "select error" << std::endl;
     return false;
diff --git a/tcpthread.cpp b/tcpthread.cpp
index bb5a7b2..d998b8f 100644
--- a/tcpthread.cpp
+++ b/tcpthread.cpp
@@ -97,7 +97,7 @@ void TCPThread::run() {
         }
       } else {
         /* Wait here for some time until the next attempt */
-        std::this_thread::sleep_for(std::chrono::seconds(2));
+        std::this_thread::sleep_for(std::chrono::milliseconds(100));
       }
     } else {
       /* Prepare readfds */
